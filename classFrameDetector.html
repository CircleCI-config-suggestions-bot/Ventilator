<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RespiraWorks Ventilator: FrameDetector&lt; FrameBufferLength &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RespiraWorks Ventilator
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="classFrameDetector-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">FrameDetector&lt; FrameBufferLength &gt; Class Template Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;frame_detector.h&gt;</code></p>
<div class="dynheader">
Inheritance diagram for FrameDetector&lt; FrameBufferLength &gt;:</div>
<div class="dyncontent">
<div class="center"><img src="classFrameDetector__inherit__graph.png" border="0" usemap="#aFrameDetector_3_01FrameBufferLength_01_4_inherit__map" alt="Inheritance graph"/></div>
<map name="aFrameDetector_3_01FrameBufferLength_01_4_inherit__map" id="aFrameDetector_3_01FrameBufferLength_01_4_inherit__map">
<area shape="rect" title=" " alt="" coords="5,80,220,121"/>
<area shape="rect" href="classRxListener.html" title=" " alt="" coords="67,5,158,32"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for FrameDetector&lt; FrameBufferLength &gt;:</div>
<div class="dyncontent">
<div class="center"><img src="classFrameDetector__coll__graph.png" border="0" usemap="#aFrameDetector_3_01FrameBufferLength_01_4_coll__map" alt="Collaboration graph"/></div>
<map name="aFrameDetector_3_01FrameBufferLength_01_4_coll__map" id="aFrameDetector_3_01FrameBufferLength_01_4_coll__map">
<area shape="rect" title=" " alt="" coords="5,95,220,136"/>
<area shape="rect" href="classRxListener.html" title=" " alt="" coords="13,5,103,32"/>
<area shape="rect" href="classRxBuffer.html" title="Abstract class for serial receiver buffers." alt="" coords="128,5,207,32"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a5c3ae29cdf5af8450b9137b83efa8cbc"><td class="memItemLeft" align="right" valign="top"><a id="a5c3ae29cdf5af8450b9137b83efa8cbc"></a>enum class &#160;</td><td class="memItemRight" valign="bottom"><b>State</b> { <b>Lost</b>
, <b>WaitForStartMarker</b>
, <b>ReceivingFrame</b>
 }</td></tr>
<tr class="separator:a5c3ae29cdf5af8450b9137b83efa8cbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a9f7234bbdde64422cc6961d1d17e6285"><td class="memItemLeft" align="right" valign="top"><a id="a9f7234bbdde64422cc6961d1d17e6285"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>FrameDetector</b> (<a class="el" href="classRxBuffer.html">RxBuffer</a> *)</td></tr>
<tr class="separator:a9f7234bbdde64422cc6961d1d17e6285"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ff9bdc650643e46631ce991e6fe486d"><td class="memItemLeft" align="right" valign="top"><a id="a0ff9bdc650643e46631ce991e6fe486d"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>begin</b> ()</td></tr>
<tr class="separator:a0ff9bdc650643e46631ce991e6fe486d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae83bf69c29f36c2e2fbcafdc760bc004"><td class="memItemLeft" align="right" valign="top"><a id="ae83bf69c29f36c2e2fbcafdc760bc004"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>on_character_match</b> () override</td></tr>
<tr class="separator:ae83bf69c29f36c2e2fbcafdc760bc004"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adaf3ee49faeb567daca8524af0d2a992"><td class="memItemLeft" align="right" valign="top"><a id="adaf3ee49faeb567daca8524af0d2a992"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>on_rx_error</b> (RxError) override</td></tr>
<tr class="separator:adaf3ee49faeb567daca8524af0d2a992"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addee4823c2d933362b10306af1391788"><td class="memItemLeft" align="right" valign="top"><a id="addee4823c2d933362b10306af1391788"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>on_rx_complete</b> () override</td></tr>
<tr class="separator:addee4823c2d933362b10306af1391788"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac13bc1ccec1b9f3b02aae227e2da45c5"><td class="memItemLeft" align="right" valign="top"><a id="ac13bc1ccec1b9f3b02aae227e2da45c5"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>frame_available</b> () const</td></tr>
<tr class="separator:ac13bc1ccec1b9f3b02aae227e2da45c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb12ef15ba01af72bb0a8750605d1c6c"><td class="memItemLeft" align="right" valign="top"><a id="aeb12ef15ba01af72bb0a8750605d1c6c"></a>
size_t&#160;</td><td class="memItemRight" valign="bottom"><b>frame_length</b> () const</td></tr>
<tr class="separator:aeb12ef15ba01af72bb0a8750605d1c6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af099329f53c3582a779eed08d706ec56"><td class="memItemLeft" align="right" valign="top"><a id="af099329f53c3582a779eed08d706ec56"></a>
uint8_t *&#160;</td><td class="memItemRight" valign="bottom"><b>take_frame</b> ()</td></tr>
<tr class="separator:af099329f53c3582a779eed08d706ec56"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a087419105cdd06d2fa8feb344e694b80"><td class="memItemLeft" align="right" valign="top"><a id="a087419105cdd06d2fa8feb344e694b80"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>restart_rx</b> ()</td></tr>
<tr class="separator:a087419105cdd06d2fa8feb344e694b80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae899a3137282d7d76039364d199989f8"><td class="memItemLeft" align="right" valign="top"><a id="ae899a3137282d7d76039364d199989f8"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>data_received</b> ()</td></tr>
<tr class="separator:ae899a3137282d7d76039364d199989f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a235699d3693d17ad685b13fd81ee7755"><td class="memItemLeft" align="right" valign="top"><a id="a235699d3693d17ad685b13fd81ee7755"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>only_markers_received</b> ()</td></tr>
<tr class="separator:a235699d3693d17ad685b13fd81ee7755"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2aa5aec07ac996f5fc77a4892cedfd86"><td class="memItemLeft" align="right" valign="top"><a id="a2aa5aec07ac996f5fc77a4892cedfd86"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>process_received_data</b> ()</td></tr>
<tr class="separator:a2aa5aec07ac996f5fc77a4892cedfd86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7652caa643d2ba572940e69f83ad89bb"><td class="memItemLeft" align="right" valign="top"><a id="a7652caa643d2ba572940e69f83ad89bb"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>on_char_match_with_data</b> ()</td></tr>
<tr class="separator:a7652caa643d2ba572940e69f83ad89bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d60bced9cbd854e9f565f8d9c5aea61"><td class="memItemLeft" align="right" valign="top"><a id="a7d60bced9cbd854e9f565f8d9c5aea61"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>on_char_match_with_markers_only</b> ()</td></tr>
<tr class="separator:a7d60bced9cbd854e9f565f8d9c5aea61"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:aff2d3b94371a7b41d4bfb5f3f7b54405"><td class="memItemLeft" align="right" valign="top"><a id="aff2d3b94371a7b41d4bfb5f3f7b54405"></a>
<a class="el" href="classRxBuffer.html">RxBuffer</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFrameDetector.html#aff2d3b94371a7b41d4bfb5f3f7b54405">rx_buffer_</a></td></tr>
<tr class="memdesc:aff2d3b94371a7b41d4bfb5f3f7b54405"><td class="mdescLeft">&#160;</td><td class="mdescRight">Using protected so that derived class with back-door can be used for testing. <br /></td></tr>
<tr class="separator:aff2d3b94371a7b41d4bfb5f3f7b54405"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1663998d94de52bf7aedec1f46905b09"><td class="memItemLeft" align="right" valign="top"><a id="a1663998d94de52bf7aedec1f46905b09"></a>
State&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFrameDetector.html#a1663998d94de52bf7aedec1f46905b09">state_</a> {State::Lost}</td></tr>
<tr class="memdesc:a1663998d94de52bf7aedec1f46905b09"><td class="mdescLeft">&#160;</td><td class="mdescRight">\TODO const ptr? <br /></td></tr>
<tr class="separator:a1663998d94de52bf7aedec1f46905b09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23d285e0df5e9781166cc3c7468d06bd"><td class="memItemLeft" align="right" valign="top"><a id="a23d285e0df5e9781166cc3c7468d06bd"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>frame_available_</b> {false}</td></tr>
<tr class="separator:a23d285e0df5e9781166cc3c7468d06bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ac539bc57e6a3610e95bcecd79f60ab"><td class="memItemLeft" align="right" valign="top"><a id="a1ac539bc57e6a3610e95bcecd79f60ab"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>frame_buffer_</b> [FrameBufferLength] = {0}</td></tr>
<tr class="separator:a1ac539bc57e6a3610e95bcecd79f60ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6aa286e6384c9f0af9d8910414b83513"><td class="memItemLeft" align="right" valign="top"><a id="a6aa286e6384c9f0af9d8910414b83513"></a>
size_t&#160;</td><td class="memItemRight" valign="bottom"><b>frame_buf_length_</b> {0}</td></tr>
<tr class="separator:a6aa286e6384c9f0af9d8910414b83513"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a315d3f20596984f71aade9ace823d786"><td class="memItemLeft" align="right" valign="top"><a id="a315d3f20596984f71aade9ace823d786"></a>
size_t&#160;</td><td class="memItemRight" valign="bottom"><b>marker_count_</b> {0}</td></tr>
<tr class="separator:a315d3f20596984f71aade9ace823d786"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h3>template&lt;size_t FrameBufferLength&gt;<br />
class FrameDetector&lt; FrameBufferLength &gt;</h3>

<p><a class="el" href="classFrameDetector.html">FrameDetector</a> detects frames of this format: ...MbbbbbbbbbbbM... Where M is frame MARK byte and b is any other byte. It is responsibility of sender to ensure that MARK characters appear in the incoming stream to only mark the start and the end of the frame.</p>
<p>Correct stream of frames will look like this: ...MbbbbbbMMbbbbbbbbMMbbbbbbbbbMMbbbbbM... In practical terms, this is achieved by passing the stream through an <a class="el" href="classEscapeStream.html">EscapeStream</a> object before sending it on the line (on the sender's end).</p>
<p><a class="el" href="classRxBuffer.html" title="Abstract class for serial receiver buffers.">RxBuffer</a> is responsible for underlying reception and buffering of incoming data. Also <a class="el" href="classRxBuffer.html" title="Abstract class for serial receiver buffers.">RxBuffer</a> provides callbacks described by <a class="el" href="classRxListener.html">RxListener</a> interface. In particular:</p>
<p>on_character_match is called when MARK character is received on_rx_complete is called when the requested number of bytes was received on_rx_error is called when an error occurs in the underlying reception infrastructure</p>
<p><a class="el" href="classFrameDetector.html">FrameDetector</a> is modeled as a Finite State Machine having states:</p>
<p>Lost - <a class="el" href="classFrameDetector.html">FrameDetector</a> is lost in the stream of incoming bytes and will interpret the next MARK byte as an end of the frame. WaitForStartMarker - <a class="el" href="classFrameDetector.html">FrameDetector</a> is synced and is waiting for MARK byte that will denote the start of the frame ReceivingFrame - <a class="el" href="classFrameDetector.html">FrameDetector</a> is synced and will interpret the next MARK byte as an end of the frame and will interpret the bytes in <a class="el" href="classRxBuffer.html" title="Abstract class for serial receiver buffers.">RxBuffer</a> as a frame.</p>
<p>on_rx_error will cause <a class="el" href="classFrameDetector.html">FrameDetector</a> to transition to the Lost state, frame being received will be ignored: ...MbbbbbbEbbbbMMbbbbbbbM ^--------&mdash;^ this frame will be ignored ^----&mdash;^ this frame will be received</p>
<p>on_rx_complete should not happen in normal reception. When FrameEncoder orders a reception from <a class="el" href="classRxBuffer.html" title="Abstract class for serial receiver buffers.">RxBuffer</a>, it specifies maximum length of the frame expected, also FrameEncoder restarts reception upon receiving OnCharMatch callback. Thus, receiving OnRxComplete callback means that we get no MARK characters in the stream because sender is sending garbage or a frame that is longer than the expected length.</p>
<p><a class="el" href="classFrameDetector.html">FrameDetector</a> keeps a copy of the last successfully received frame and a flag denoting if the last received frame was read by the caller. </p>
</div><hr/>The documentation for this class was generated from the following file:<ul>
<li>/home/runner/work/Ventilator/Ventilator/software/common/libs/framing/frame_detector.h</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
